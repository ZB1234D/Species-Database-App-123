<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SBA Home</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- PWA -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#0b5c37" />
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="css/layout.css" />
    <link rel="stylesheet" href="css/filters.css" />
    <link rel="stylesheet" href="css/cards.css" />
    <link rel="stylesheet" href="css/responsive.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="app-header">
        <div class="header-top">
          <h1 class="header-title">Baze-dadus Espésie sira</h1>
          <button class="lang-btn">EN</button>
        </div>

        <div class="search-bar">
          <span class="search-icon">
            <img src="./Assets/icons/search.svg" alt="Search" />
          </span>
          <input type="text" placeholder="Buka espésie sira" />
        </div>
      </header>

      <!-- Filter Carousel -->
      <div class="filter-carousel-container">
        <div class="filter-carousel" id="filter-carousel">
          <button class="filter-button" data-filter="all">All</button>
          <button class="filter-button" data-filter="a-z">A--Z</button>
          <button class="filter-button" data-filter="scientific-name">
            Naran Sientífiku
          </button>
          <button class="filter-button" data-filter="leaf-type">
            Tipu Daun
          </button>
          <button class="filter-button" data-filter="fruit-type">
            Tipu Ai-fuan
          </button>
          <button class="filter-button" data-filter="common-name">
            Naran Komún
          </button>
        </div>
      </div>

      <div class="container" id="species-list"></div>

      <script src="scripts/config.js"></script>
      <script src="scripts/db.js"></script>
      <script src="scripts/dataService.js"></script>
      <script src="scripts/sync.js"></script>
      <script src="scripts/specieslist.js"></script>
      <script src="scripts/filterCarousel.js"></script>

      <a class="back-link" href="index.html"></a>

      <div class="debug" id="debugInfo"></div>

      <!-- LANGUAGE OVERLAY -->
      <div class="lang-overlay" id="langOverlay">
        <div class="lang-modal">
          <button class="close-overlay" id="closeOverlay">✖</button>
          <button class="lang-choice" id="chooseEn">English</button>
          <button class="lang-choice" id="chooseTet">Tetum</button>
        </div>
      </div>

      <!-- FILTER OVERLAY (NEW) -->
      <div class="filter-overlay" id="filterOverlay">
        <div class="filter-modal">
          <button class="close-filter-overlay" id="closeFilterOverlay">
            ✖
          </button>
          <h2 id="filterTitle">Filter Options</h2>
          <p>(Placeholder options)</p>
          <button class="placeholder-option">Option 1</button>
          <button class="placeholder-option">Option 2</button>
          <button class="placeholder-option">Option 3</button>
        </div>
      </div>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          console.log("[Tetum] Starting sync...");
          if (window.syncManager && typeof syncManager.checkAndSync === "function") {
            const result = await syncManager.checkAndSync({ forceBundle: true });
            console.log("[Tetum] Sync result:", result);
          } else {
            console.warn("[Tetum] syncManager not available");
          }

          const species = await dataService.getAllSpecies("tet");
          console.log("[Tetum] Loaded species:", species.length);

          if (typeof window.setSpeciesData === "function") {
            window.setSpeciesData(species);
          } else {
            console.warn("[Tetum] setSpeciesData is not defined");
          }
        } catch (err) {
          console.error("[Tetum] Error during initial load:", err);
        }
      });

      // LANGUAGE HANDLER
      let lang = "tet";

      try {
        const stored = localStorage.getItem("appLanguage");
        if (stored === "en" || stored === "tet") {
          lang = stored;
        }
      } catch (e) {
        console.warn("Could not access localStorage:", e);
      }

      const langBtn = document.querySelector(".lang-btn");
      langBtn.textContent = lang === "en" ? "EN" : "TET";

      const overlay = document.getElementById("langOverlay");
      const closeBtn = document.getElementById("closeOverlay");
      const chooseEn = document.getElementById("chooseEn");
      const chooseTet = document.getElementById("chooseTet");

      langBtn.addEventListener("click", () => {
        overlay.style.display = "flex";
      });

      closeBtn.addEventListener("click", () => {
        overlay.style.display = "none";
      });

      chooseEn.addEventListener("click", () => {
        localStorage.setItem("appLanguage", "en");
        langBtn.textContent = "EN";
        overlay.style.display = "none";
        window.location.href = "home.html";
      });

      chooseTet.addEventListener("click", () => {
        localStorage.setItem("appLanguage", "tet");
        langBtn.textContent = "TET";
        overlay.style.display = "none";
        window.location.href = "tetum.html";
      });

      // ------------------------------
      // FILTER OVERLAY JS (NEW)
      // ------------------------------
      const filterOverlay = document.getElementById("filterOverlay");
      const closeFilterOverlay = document.getElementById("closeFilterOverlay");
      const filterTitle = document.getElementById("filterTitle");

      document.querySelectorAll(".filter-button").forEach((btn) => {
        btn.addEventListener("click", () => {
          const label = btn.textContent.trim();
          filterTitle.textContent = label + " Options";
          filterOverlay.style.display = "flex";
        });
      });

      closeFilterOverlay.addEventListener("click", () => {
        filterOverlay.style.display = "none";
      });
    </script>
  </body>
</html>
